syntax = "proto3";

package studyroom.reservation.v1;

import "google/protobuf/timestamp.proto";

// 예약 우선순위 (ENUM)
enum ReservationPriority {
  RESERVATION_PRIORITY_UNSPECIFIED = 0; // 지정되지 않음
  RESERVATION_PRIORITY_LOW = 1;         // 낮음 (우선1)
  RESERVATION_PRIORITY_MEDIUM = 2;      // 중간 (우선2)
  RESERVATION_PRIORITY_HIGH = 3;        // 높음 (우선3)
}

// 예약 메시지 구조
message Reservation {
  int64 id = 1;                               // 내부 DB용 ID (외부 노출 금지)
  string code = 2;                            // 외부 식별용 예약 코드 (UUID 등)
  int64 room_id = 3;                          // 스터디룸 ID
  int64 group_id = 4;                         // 그룹 ID (외부 서비스 참조)
  int64 link_id = 5;                          // 외부 일정 서비스 링크 ID
  google.protobuf.Timestamp start_time = 6;   // 시작 시간
  google.protobuf.Timestamp end_time = 7;     // 종료 시간
  string purpose = 8;                         // 예약 목적/사유
  ReservationPriority priority = 9;           // 예약 우선순위
  google.protobuf.Timestamp created_at = 10;  // 생성 시각
  google.protobuf.Timestamp updated_at = 11;  // 수정 시각
  google.protobuf.Timestamp deleted_at = 12;  // 삭제 시각 (소프트 삭제)
}

// 예약 생성 요청
message CreateReservationRequest {
  int64 room_id = 1;
  int64 group_id = 2;
  int64 link_id = 3;
  google.protobuf.Timestamp start_time = 4;
  google.protobuf.Timestamp end_time = 5;
  string purpose = 6;
  ReservationPriority priority = 7;
  // created_by 제거 (API Gateway에서 metadata로 전달)
}

// 특정 예약 조회 요청
message GetReservationRequest {
  string code = 1; // 내부 id 대신 외부용 code로 조회
}

// 예약 목록 조회 요청
message ListReservationsRequest {
  int64 room_id = 1;                              // 스터디룸 ID로 필터링
  google.protobuf.Timestamp start_time_after = 2; // 특정 시간 이후 시작하는 예약
  google.protobuf.Timestamp end_time_before = 3;  // 특정 시간 이전에 끝나는 예약
  int64 group_id = 4;                             // 그룹 ID로 필터링
}

// 예약 생성 응답
message CreateReservationResponse {
  Reservation reservation = 1;
  
}

// 특정 예약 조회 응답
message GetReservationResponse {
  Reservation reservation = 1;
}

// 예약 목록 응답
message ListReservationsResponse {
  repeated Reservation reservations = 1;
}

// 예약 정보 업데이트 요청
message UpdateReservationRequest {
  string code = 1;                              // 내부 id 대신 code 기반 수정
  int64 room_id = 2;
  int64 group_id = 3;
  int64 link_id = 4;
  google.protobuf.Timestamp start_time = 5;
  google.protobuf.Timestamp end_time = 6;
  string purpose = 7;
  ReservationPriority priority = 8;
  // updated_by 제거 (metadata로 전달)
}

// 예약 업데이트 응답
message UpdateReservationResponse {
  Reservation reservation = 1;
}

// 예약 삭제 요청
message DeleteReservationRequest {
  string code = 1; // 내부 id 대신 code 기반 삭제
  // deleted_by 제거 (metadata로 전달)
}

// 예약 삭제 응답
message DeleteReservationResponse {}
